# Pyro 硬币偏置学习示例

这个项目展示了如何使用Pyro（一个基于PyTorch的概率编程库）来实现贝叶斯推断，具体通过硬币偏置学习的经典问题来演示概率推断的核心概念。

## 项目概述

本项目实现了一个完整的贝叶斯推断流程，从观测数据中学习硬币的偏置概率。通过变分推断（Variational Inference）方法，我们可以近似计算后验分布，并进行预测分析。

## 主要功能

### 🎯 核心功能
- **贝叶斯推断**: 使用Beta-Bernoulli共轭先验进行硬币偏置学习
- **变分推断**: 通过SVI（随机变分推断）优化变分后验
- **先验比较**: 展示不同先验分布对推断结果的影响
- **预测分析**: 基于学习到的后验分布预测未来投掷结果
- **可视化分析**: 生成详细的图表展示推断过程和结果

### 📊 分析内容
1. **基本推断**: 从观测数据学习硬币偏置概率
2. **后验分布分析**: 计算后验统计量和置信区间
3. **先验敏感性分析**: 比较5种不同先验的影响
4. **预测模拟**: 模拟未来投掷结果的分布
5. **可视化展示**: 6个子图展示完整的分析过程

## 安装要求

确保您的系统已安装Python 3.7+，然后安装所需依赖：

```bash
pip install -r requirements.txt
```

### 依赖包
- `numpy>=1.21.0` - 数值计算
- `matplotlib>=3.5.0` - 数据可视化
- `scipy>=1.7.0` - 科学计算
- `torch>=1.9.0` - 深度学习框架
- `pyro-ppl>=1.8.0` - 概率编程库

## 使用方法

### 快速开始

直接运行主程序：

```bash
python coin_bias_learning.py
```

程序将自动执行所有分析步骤并输出结果。

### 示例输出

```
=== 硬币偏置学习示例 ===
观测数据：10次投掷，8次正面，2次反面

观测数据: [1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0]
正面次数: 8.0
反面次数: 2.0
经验概率: 0.80

开始训练...
迭代   0, 损失: 7.4521
迭代 100, 损失: 6.9234
...

=== 学习结果 ===
学习参数: alpha=9.125, beta=3.089
推断正面概率: 0.747
理论后验均值: 0.750
```

## 代码结构

### 核心函数

#### `coin_model(data)`
定义生成模型，包含：
- Beta(1,1)均匀先验
- Bernoulli似然函数

#### `coin_guide(data)`
构建变分后验（引导函数）：
- 可学习的Beta分布参数
- 约束参数为正数

#### `run_basic_inference()`
执行基本贝叶斯推断：
- 设置观测数据
- 配置SVI优化器
- 训练变分后验
- 输出学习结果

#### `advanced_analysis(alpha, beta)`
高级统计分析：
- 后验分布采样
- 计算置信区间
- 统计量分析

#### `compare_priors()`
先验敏感性分析：
- 5种不同先验设置
- 比较推断结果差异

#### `simulate_predictions(alpha, beta)`
预测分析：
- 从后验采样
- 模拟未来投掷
- 统计预测分布

#### `plot_results(alpha, beta, samples, losses)`
可视化结果：
- 训练损失曲线
- 后验分布直方图
- 先验vs后验对比
- 参数收敛图
- 置信区间展示
- 预测分布图

## 理论背景

### 贝叶斯推断
使用贝叶斯定理更新对硬币偏置的信念：

```
P(p|data) ∝ P(data|p) × P(p)
```

其中：
- `P(p|data)`: 后验分布
- `P(data|p)`: 似然函数（Bernoulli）
- `P(p)`: 先验分布（Beta）

### Beta-Bernoulli共轭性
Beta分布是Bernoulli似然的共轭先验，使得：
- 先验：Beta(α₀, β₀)
- 似然：Bernoulli(p)
- 后验：Beta(α₀ + 成功次数, β₀ + 失败次数)

### 变分推断
当后验分布难以直接计算时，使用变分推断：
1. 选择变分族（如Beta分布）
2. 最小化KL散度
3. 通过ELBO优化变分参数

## 实验结果解读

### 推断准确性
- **理论后验均值**: 0.750 (基于Beta-Bernoulli共轭性)
- **变分推断结果**: ~0.747 (非常接近理论值)

### 先验影响
不同先验对推断结果的影响：
- 均匀先验：最小偏置
- 强信息先验：更多正则化
- 偏置先验：向特定方向拉拽

### 置信区间
95%置信区间提供不确定性量化，帮助理解推断的可靠性。

## 扩展应用

这个示例可以扩展到：

1. **A/B测试**: 比较两个版本的转化率
2. **医学试验**: 评估治疗效果
3. **质量控制**: 产品缺陷率估计
4. **金融建模**: 违约概率估计
5. **机器学习**: 分类器性能评估

## 进阶学习

### 相关概念
- **MCMC方法**: 马尔可夫链蒙特卡罗采样
- **变分自编码器**: VAE中的变分推断
- **贝叶斯神经网络**: 神经网络中的不确定性
- **高斯过程**: 非参数贝叶斯方法

### 推荐资源
- [Pyro官方文档](https://pyro.ai/)
- [Pattern Recognition and Machine Learning](http://users.isr.ist.utl.pt/~wurmd/Livros/school/Bishop%20-%20Pattern%20Recognition%20And%20Machine%20Learning%20-%20Springer%20%202006.pdf)
- [Probabilistic Programming and Bayesian Methods for Hackers](https://github.com/CamDavidsonPilon/Probabilistic-Programming-and-Bayesian-Methods-for-Hackers)

## 许可证

本项目仅供学习和研究使用。

## 贡献

欢迎提交问题和改进建议！

---

*这个示例展示了概率编程的强大功能，通过简单的硬币投掷问题揭示了贝叶斯推断的核心思想。*
